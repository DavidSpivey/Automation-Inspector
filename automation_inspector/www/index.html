<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<title>Automation Inspector</title>
<style>
 body{font-family:sans-serif;margin:1rem}
 table{border-collapse:collapse;width:100%}
 th,td{padding:.3rem .6rem;border-bottom:1px solid #ccc;vertical-align:top}
 tr:nth-child(even){background:#f7f7f7}
 code{background:#eee;padding:2px 4px;border-radius:4px;margin-right:4px;display:inline-block}
 code.bad{background:#fdd;color:#900;border:1px solid #d66}
</style>
</head>
<body>
<h2>Automation Inspector</h2>
<table id="tbl">
 <thead><tr><th>Automation</th><th>Entities</th></tr></thead><tbody></tbody>
</table>

<script>
async function load(){
  const resp = await fetch("/dependency_map.json");
  const data = await resp.json();
  const tbody=document.querySelector("#tbl tbody");
  Object.entries(data).forEach(([auto,info])=>{
    const tr=document.createElement("tr");
    const ents = info.entities.map(e=>{
      const cls = e.ok ? "" : "bad";
      return `<code class="${cls}">${e.id}: ${e.state}</code>`;
    }).join(" ");
    tr.innerHTML=`<td><code>${auto}</code><br>${info.friendly_name}</td><td>${ents}</td>`;
    tbody.appendChild(tr);
  });
}
load();
</script>
</body>
</html>
